<form [formGroup]="form" (ngSubmit)="save()">
  <fieldset>
    <legend>Project title</legend>
    <input formControlName="title" placeholder="Roadmap 2025" />
    @if (form.controls.title.invalid && form.controls.title.touched) {
      <small>⚠️ This field is required.</small>
    }
  </fieldset>

  <fieldset>
    <legend>Description</legend>
    <textarea rows="3" formControlName="description" placeholder="Describe the scope"></textarea>
  </fieldset>

  <fieldset formGroupName="startDate">
    <legend>Start date</legend>
    <div class="fieldset-grid">
      <div>
        <label>Year</label>
        <input type="number" formControlName="year" [class.ng-invalid]="dateRangeError()" [class.ng-touched]="dateRangeError()" />
        @if (form.controls.startDate.controls.year.errors?.['min'] && form.controls.startDate.controls.year.touched) {
          <small>⚠️ Minimum allowed year is {{ form.controls.startDate.controls.year.errors?.['min'].min }}.</small>
        }
        @if (form.controls.startDate.controls.year.errors?.['max'] && form.controls.startDate.controls.year.touched) {
          <small>⚠️ Maximum allowed year is {{ form.controls.startDate.controls.year.errors?.['max'].max }}.</small>
        }
      </div>
      <div>
        <label>Month</label>
        <select formControlName="month" [class.ng-invalid]="dateRangeError()" [class.ng-touched]="dateRangeError()">
          @for (month of core.monthNames; track month; let idx = $index) {
            <option [ngValue]="idx">{{ month }}</option>
          }
        </select>
      </div>
      <div>
        <label>Week</label>
        <select formControlName="week" [class.ng-invalid]="dateRangeError()" [class.ng-touched]="dateRangeError()">
          <option [ngValue]="0">Week 1</option>
          <option [ngValue]="1">Week 2</option>
          <option [ngValue]="2">Week 3</option>
          <option [ngValue]="3">Week 4</option>
        </select>
      </div>
    </div>
  </fieldset>

  <fieldset formGroupName="endDate">
    <legend>End date</legend>
    <div class="fieldset-grid">
      <div>
        <label>Year</label>
        <input type="number" formControlName="year" [class.ng-invalid]="dateRangeError()" [class.ng-touched]="dateRangeError()" />
        @if (form.controls.endDate.controls.year.errors?.['min'] && form.controls.endDate.controls.year.touched) {
          <small>⚠️ Minimum allowed year is {{ form.controls.endDate.controls.year.errors?.['min'].min }}.</small>
        }
        @if (form.controls.endDate.controls.year.errors?.['max'] && form.controls.endDate.controls.year.touched) {
          <small>⚠️ Maximum allowed year is {{ form.controls.endDate.controls.year.errors?.['max'].max }}.</small>
        }
      </div>
      <div>
        <label>Month</label>
        <select formControlName="month" [class.ng-invalid]="dateRangeError()" [class.ng-touched]="dateRangeError()">
          @for (month of core.monthNames; track month; let idx = $index) {
            <option [ngValue]="idx">{{ month }}</option>
          }
        </select>
      </div>
      <div>
        <label>Week</label>
        <select formControlName="week" [class.ng-invalid]="dateRangeError()" [class.ng-touched]="dateRangeError()">
          <option [ngValue]="0">Week 1</option>
          <option [ngValue]="1">Week 2</option>
          <option [ngValue]="2">Week 3</option>
          <option [ngValue]="3">Week 4</option>
        </select>
      </div>
    </div>
    @if (form.errors?.['dateRange'] && form.touched) {
      <small>⚠️ The end date must be after the start date.</small>
    }
  </fieldset>

  <fieldset>
    <legend>Extra fields</legend>
    <div class="additional-controls" [formGroup]="additionalFieldForm">
      <div class="additional-field">
        <input placeholder="Field name" formControlName="key" />
        @if (additionalFieldForm.controls.key.invalid && additionalFieldForm.controls.key.touched) {
          <small>⚠️ This field is required.</small>
        }
      </div>
      <div class="additional-field">
        <input placeholder="Value" formControlName="value" />
        @if (additionalFieldForm.controls.value.invalid && additionalFieldForm.controls.value.touched) {
          <small>⚠️ This field is required.</small>
        }
      </div>
      <button class="btn ghost" type="button" (click)="addAdditionalField()">Add field</button>
    </div>
    @if (additionalFieldForm.controls.key.errors?.['duplicated']) {
      <small>The field already exists in the list.</small>
    }
    <div class="stack-sm">
      @for (field of additionalFieldList(); track field.key) {
        <div class="field-group">
          <label>{{ field.key }}</label>
          <input [formControl]="field.control" />
          <button class="btn danger" type="button" (click)="removeAdditionalField(field.key)">Delete</button>
        </div>
      }
    </div>
  </fieldset>

  <div class="form-actions">
    <button class="btn primary" type="submit">Update project</button>
    <button class="btn ghost" type="button" (click)="cancelProjectEdition()">Cancel</button>
  </div>
</form>

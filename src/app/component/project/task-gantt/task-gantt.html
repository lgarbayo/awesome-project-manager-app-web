<article class="card pad stack-md table-card tasks">
    <div class="row row-refresh">
        <h2 class="title">Tasks</h2>
        <button class="btn primary icon-only" type="button" (click)="addTask.emit()">
            <img src="/add.svg" alt="Add task" width="24" height="24" />
        </button>
    </div>
    @if (loading()) {
    <p>Loading tasks...</p>
    }
    @if (error(); as taskError) {
    <p class="error">{{ taskError }}</p>
    }
    @if (!loading() && !hasTasks()) {
    <p>No tasks registered yet.</p>
    } @else {
    <div class="table-wrapper">
        <table class="data-table task-table">
            <colgroup>
                <col class="col-title" />
                <col class="col-duration" />
                <col class="col-schedule" />
                <col class="col-actions" />
            </colgroup>
            <thead>
                <tr>
                    <th>Title</th>
                    <th>Duration</th>
                    <th class="gantt-header schedule-col">
                        <div class="gantt-scroll" #ganttViewport (scroll)="onGanttScroll($event)">
                            <div class="gantt-content" [style.width.px]="timelineWidth()">
                                <div class="gantt-scale">
                                    <div class="gantt-month-row">
                                        @for (month of timelineMonths(); track month.start) {
                                        <span class="gantt-month" [style.width.%]="monthWidth(month)">{{ month.label
                                            }}</span>
                                        }
                                    </div>
                                    <div class="gantt-week-row">
                                        @for (week of timelineWeeks(); track week.start) {
                                        <span class="gantt-week-label" [style.left.%]="weekMarkerPosition(week)">{{
                                            week.label }}</span>
                                        }
                                    </div>
                                </div>
                            </div>
                        </div>
                    </th>
                    <th></th>
                </tr>
            </thead>
            <tbody>
                @for (task of taskList(); track task.uuid) {
                <tr>
                    <td>{{ task.title }}</td>
                    <td>{{ task.durationWeeks }} weeks</td>
                    <td class="gantt-cell schedule-col">
                        <div class="gantt-scroll gantt-scroll--row" #ganttRow (scroll)="onGanttScroll($event)">
                            <div class="gantt-content" [style.width.px]="timelineWidth()">
                                <div class="gantt-track">
                                    @for (week of timelineWeeks(); track week.start) {
                                    <span class="gantt-division" [style.left.%]="weekMarkerPosition(week)"></span>
                                    }
                                    <span class="gantt-bar" [style.left.%]="taskStartOffset(task)"
                                        [style.width.%]="taskDurationPercent(task)">
                                        <span class="gantt-tooltip">{{ taskTooltip(task) }}</span>
                                    </span>
                                </div>
                            </div>
                        </div>
                    </td>
                    <td class="table-actions">
                        <button class="btn ghost" type="button" (click)="describeTask.emit(task)">DESCRIPTION</button>
                        <button class="btn ghost" type="button" (click)="analyseTask.emit(task.uuid)">ANALYSIS</button>
                        <button class="btn ghost icon-only" type="button" (click)="editTask.emit(task)">
                            <img src="/edit.svg" alt="Edit task" width="20" height="20" />
                        </button>
                        <button class="btn danger icon-only" type="button" (click)="removeTask.emit(task.uuid)">
                            <img src="/trash.svg" alt="Delete task" width="20" height="20" />
                        </button>
                    </td>
                </tr>
                }
            </tbody>
        </table>
    </div>
    }
</article>